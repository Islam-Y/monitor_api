<changeSet id="004" author="user">
    <!-- Создание таблицы для api_metrics -->
    <createTable tableName="api_metrics">
        <column name="id" type="BIGINT" autoIncrement="true">
            <constraints primaryKey="true" nullable="false"/>
        </column>
        <column name="endpoint_id" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="api_url" type="VARCHAR(2048)">
            <constraints nullable="false"/>
        </column>
        <column name="api_name" type="VARCHAR(256)">
            <constraints nullable="false"/>
        </column>
        <column name="status_code" type="INT">
            <constraints nullable="false"/>
        </column>
        <column name="response_time_ms" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="timestamp" type="TIMESTAMP">
            <constraints nullable="false" updatable="false"/>
        </column>
        <column name="success" type="BOOLEAN">
            <constraints nullable="false"/>
        </column>
        <column name="error_message" type="VARCHAR(2048)"/>
        <column name="response_id" type="BIGINT"/>

        <!-- Создание внешнего ключа для связи с api_endpoints -->
        <foreignKeyConstraint baseColumnNames="endpoint_id"
                              baseTableName="api_metrics"
                              referencedTableName="api_endpoints"
                              referencedColumnNames="id"
                              constraintName="fk_metrics_endpoint"/>

        <!-- Индексы для ускорения поиска -->
        <addIndex indexName="idx_api_metrics_endpoint" tableName="api_metrics">
            <column name="endpoint_id"/>
        </addIndex>
        <addIndex indexName="idx_api_metrics_timestamp" tableName="api_metrics">
            <column name="timestamp"/>
        </addIndex>
    </createTable>
</changeSet>
